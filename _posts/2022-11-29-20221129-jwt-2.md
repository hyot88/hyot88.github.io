---
title:  "Spring Boot에 JWT 적용하기 - 2"
excerpt: "JWT 인증 필터 구현"
toc: true
toc_sticky: true
header:
  teaser: /assets/images/dev.jpg

categories:
  - Spring Boot
tags:
  - ASAP
  - 프로젝트
  - Spring Boot
last_modified_at: 2022-11-29T14:51
---

저번 포스트에 이어 서버에서 사용자 인증여부를 체크하는 방법에 대해 알아보자  
모든 요청에 대해서 사전 체크를 할 수 있도록 Filter 클래스를 하나 만든다.  
doFilterInternal() 첫 줄 영역에 들어갈 체크로직들은 하나씩 천천히 살펴보도록 한다.  
전체 코드는 [이곳](https://github.com/hyot88/ASAP-api/blob/f28b4989bc840bb506b1741a23927311874881b6/src/main/java/com/fourtwod/config/auth/JWTAuthorizationFilter.java) 에서 확인 가능하다.  

```java
public class JWTAuthorizationFilter extends OncePerRequestFilter {

    private final String HEADER = "Authorization";
    private final String BEARER = "Bearer ";

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {
		    // JWT 토큰을 디코딩하여 체크하는 로직이 들어갈 영역

        setSpringAuthentication(claims);
        chain.doFilter(request, response);
    }

    private void setSpringAuthentication(Claims claims) {
        Set<GrantedAuthority> grantedAuthorities = new HashSet<>();
        grantedAuthorities.add(new SimpleGrantedAuthority("ROLE_USER")); // 고정
        UsernamePasswordAuthenticationToken auth = new UsernamePasswordAuthenticationToken(claims.getId(), null, grantedAuthorities);
        
        // 인증객체 등록
        SecurityContextHolder.getContext().setAuthentication(auth);
    }
}
```

먼저 헤더 스키마를 체크한다.  
```java
private final String HEADER = "Authorization";
private final String BEARER = "Bearer ";

...
// 헤더 스키마 체크
if (!checkJWTToken(request)) {
  outPrintln(response, ResponseCode.TOKN_E001);
  return;
}
...
private boolean checkJWTToken(HttpServletRequest request) {
  String authenticationHeader = request.getHeader(HEADER);
  return authenticationHeader != null && authenticationHeader.startsWith(BEARER);
}
```